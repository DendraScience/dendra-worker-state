{
  "_id": "agent-archive-default",
  "source_defaults": {},
  "sources": [
    {
      "description": "ERCZO: Archive records imported from CSI",
      "error_subject": "erczo.archive.v1.err.import.csi",
      "preprocessing_expr": [
        "($station := payload.station ~> $safeName;",
        "$table := payload.table ~> $safeName;",
        "$time := payload.timeString;",
        "$recNum := $pad($string(payload.recordNumber), -10, '0');",
        "$docId := $join(['erczo', 'csi', $station, $table, $substring($time, 0, 10), $substring($time, 11, 2), $substring($time, 14, 2)], '-') & '_' & $recNum;",
        "$valid := $contains($docId, /^erczo-csi-\\w+-\\w+-\\d{4}-\\d{2}-\\d{2}-\\d{2}-\\d{2}_\\d{10}$/);",
        "$params := $valid ? {'document_id': $docId} : {};",
        "$ ~> |$|{'params': $params}|;)"
      ],
      "sub_options": {
        "ack_wait": 20000,
        "durable_name": "erczo-import-csi"
      },
      "sub_to_subject": "erczo.import.v1.out.csi"
    },
    {
      "description": "UCNRS: Archive records imported from CSI",
      "error_subject": "ucnrs.archive.v1.err.import.csi",
      "preprocessing_expr": [
        "($station := payload.station ~> $safeName;",
        "$table := payload.table ~> $safeName;",
        "$time := payload.timeString;",
        "$recNum := $pad($string(payload.recordNumber), -10, '0');",
        "$docId := $join(['ucnrs', 'csi', $station, $table, $substring($time, 0, 10), $substring($time, 11, 2), $substring($time, 14, 2)], '-') & '_' & $recNum;",
        "$valid := $contains($docId, /^ucnrs-csi-\\w+-\\w+-\\d{4}-\\d{2}-\\d{2}-\\d{2}-\\d{2}_\\d{10}$/);",
        "$params := $valid ? {'document_id': $docId} : {};",
        "$ ~> |$|{'params': $params}|;)"
      ],
      "sub_options": {
        "ack_wait": 20000,
        "durable_name": "ucnrs-import-csi"
      },
      "sub_to_subject": "ucnrs.import.v1.out.csi"
    },
    {
      "description": "UCNRS: Archive DCP messages imported from GOES",
      "error_subject": "ucnrs.archive.v1.err.import.goes",
      "preprocessing_expr": [
        "($station := context.station ~> $safeName;",
        "$table := context.table ~> $safeName;",
        "$time := payload.header.timeDate;",
        "$docId := $join(['ucnrs', 'goes', $station, $table, $substring($time, 0, 10), $substring($time, 11, 2)], '-');",
        "$valid := $contains($docId, /^ucnrs-goes-\\w+-\\w+-\\d{4}-\\d{2}-\\d{2}-\\d{2}$/);",
        "$params := $valid ? {'document_id': $docId} : {};",
        "$ ~> |$|{'params': $params}|;)"
      ],
      "sub_options": {
        "ack_wait": 20000,
        "durable_name": "ucnrs-import-goes"
      },
      "sub_to_subject": "ucnrs.import.v1.out.goes"
    }
  ]
}